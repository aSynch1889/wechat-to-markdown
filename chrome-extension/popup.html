<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      width: 500px;
      max-height: 650px;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
      overflow-y: auto;
    }
    
    h2 {
      margin: 0 0 15px 0;
      font-size: 18px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      border-bottom: 2px solid #e5e7eb;
    }
    
    .tab {
      padding: 8px 16px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #6b7280;
      transition: all 0.2s;
    }
    
    .tab.active {
      color: #1a73e8;
      border-bottom-color: #1a73e8;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    button {
      width: 100%;
      padding: 12px;
      background: #1a73e8;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.2s;
      margin-bottom: 8px;
    }
    
    button:hover:not(:disabled) {
      background: #1557b0;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: #6366f1;
    }
    
    .btn-secondary:hover:not(:disabled) {
      background: #4f46e5;
    }
    
    .btn-warning {
      background: #f59e0b;
    }
    
    .btn-warning:hover:not(:disabled) {
      background: #d97706;
    }
    
    .btn-success {
      background: #10b981;
    }
    
    .btn-success:hover:not(:disabled) {
      background: #059669;
    }
    
    .btn-danger {
      background: #ef4444;
    }
    
    .btn-danger:hover:not(:disabled) {
      background: #dc2626;
    }
    
    .url-input {
      width: 100%;
      padding: 10px;
      border: 2px solid #e5e7eb;
      border-radius: 6px;
      font-size: 13px;
      margin-bottom: 8px;
      font-family: inherit;
    }
    
    .url-input:focus {
      outline: none;
      border-color: #1a73e8;
    }
    
    textarea.url-input {
      resize: vertical;
    }
    
    .instruction-box {
      background: #fef3c7;
      border: 1px solid #fbbf24;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 15px;
      font-size: 13px;
      line-height: 1.6;
    }
    
    .instruction-box strong {
      color: #92400e;
      display: block;
      margin-bottom: 8px;
    }
    
    .step-list {
      margin: 8px 0;
      padding-left: 20px;
    }
    
    .step-list li {
      margin: 4px 0;
      color: #78350f;
    }
    
    .login-status {
      padding: 12px;
      background: #f3f4f6;
      border-radius: 6px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .login-status.logged-in {
      background: #d1fae5;
      border: 1px solid #10b981;
    }
    
    .login-status.logged-out {
      background: #fee2e2;
      border: 1px solid #ef4444;
    }
    
    .status-info {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }
    
    .status-icon {
      font-size: 20px;
      flex-shrink: 0;
    }
    
    .status-text {
      flex: 1;
      min-width: 0;
    }
    
    .status-text h4 {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    
    .status-text p {
      font-size: 11px;
      color: #6b7280;
      word-wrap: break-word;
    }
    
    .article-list {
      max-height: 350px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      margin: 10px 0;
    }
    
    .article-item {
      padding: 10px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      align-items: start;
      gap: 10px;
      transition: background 0.2s;
    }
    
    .article-item:hover {
      background: #f9fafb;
    }
    
    .article-item:last-child {
      border-bottom: none;
    }
    
    .article-checkbox {
      margin-top: 2px;
      cursor: pointer;
    }
    
    .article-info {
      flex: 1;
      min-width: 0;
    }
    
    .article-title {
      font-size: 13px;
      font-weight: 500;
      color: #333;
      margin-bottom: 4px;
      word-wrap: break-word;
    }
    
    .article-meta {
      font-size: 11px;
      color: #6b7280;
    }
    
    .select-controls {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .select-controls button {
      flex: 1;
      padding: 6px;
      font-size: 12px;
      background: #f3f4f6;
      color: #374151;
    }
    
    .select-controls button:hover {
      background: #e5e7eb;
    }
    
    .loading {
      text-align: center;
      padding: 20px;
      color: #6b7280;
    }
    
    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }
    
    @keyframes dots {
      0%, 20% { content: '.'; }
      40% { content: '..'; }
      60%, 100% { content: '...'; }
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 3px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #1a73e8, #4f46e5);
      transition: width 0.3s;
    }
    
    .progress-text {
      font-size: 12px;
      color: #6b7280;
      text-align: center;
      margin-top: 5px;
    }
    
    #status {
      margin-top: 15px;
      padding: 10px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
    }
    
    .success {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #81c784;
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      border: 1px solid #ef5350;
    }
    
    .info {
      background: #e3f2fd;
      color: #1565c0;
      border: 1px solid #64b5f6;
    }
    
    .warning {
      background: #fff3e0;
      color: #e65100;
      border: 1px solid #ffb74d;
    }
    
    .hint {
      font-size: 12px;
      color: #6b7280;
      margin: 5px 0;
    }
    
    .search-section {
      margin-top: 15px;
    }
    
    .account-info {
      padding: 12px;
      background: #f3f4f6;
      border-radius: 6px;
      margin-bottom: 10px;
    }
    
    .account-name {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 4px;
    }
    
    .account-meta {
      font-size: 12px;
      color: #6b7280;
    }
    
    details {
      margin-top: 10px;
      font-size: 12px;
      color: #6b7280;
    }
    
    summary {
      cursor: pointer;
      padding: 8px;
      background: #f3f4f6;
      border-radius: 6px;
      user-select: none;
    }
    
    summary:hover {
      background: #e5e7eb;
    }
    
    details[open] summary {
      margin-bottom: 8px;
    }
    
    details div {
      padding: 10px;
      background: #f9fafb;
      border-radius: 6px;
      line-height: 1.8;
    }
    
    details ol {
      padding-left: 20px;
      margin: 8px 0;
    }
    
    details a {
      color: #1a73e8;
      text-decoration: none;
    }
    
    details a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>ğŸ“„ å¾®ä¿¡è½¬Markdown Pro</h2>
  
  <div class="tabs">
    <button class="tab active" data-tab="single">å•ç¯‡</button>
    <button class="tab" data-tab="batch">æ‰¹é‡</button>
    <button class="tab" data-tab="mp-account">å…¬ä¼—å·API</button>
  </div>
  
  <!-- å•ç¯‡è½¬æ¢ -->
  <div class="tab-content active" id="single">
    <button id="convertBtn">è½¬æ¢å½“å‰é¡µé¢</button>
  </div>
  
  <!-- æ‰¹é‡è½¬æ¢ -->
  <div class="tab-content" id="batch">
    <textarea 
      id="batchUrls" 
      class="url-input" 
      placeholder="ç²˜è´´å¤šä¸ªæ–‡ç« é“¾æ¥ï¼Œæ¯è¡Œä¸€ä¸ª"
      rows="6"
    ></textarea>
    <p class="hint">ğŸ’¡ æ¯è¡Œè¾“å…¥ä¸€ä¸ªæ–‡ç« é“¾æ¥</p>
    <button id="batchConvertBtn">å¼€å§‹æ‰¹é‡è½¬æ¢</button>
  </div>
  
  <!-- å…¬ä¼—å·åå°API -->
  <div class="tab-content" id="mp-account">
    <div class="instruction-box">
      <strong>ğŸ”‘ ä½¿ç”¨å…¬ä¼—å·åå°APIè·å–å®Œæ•´æ–‡ç« åˆ—è¡¨</strong>
      <ol class="step-list">
        <li>éœ€è¦ä¸€ä¸ªå¾®ä¿¡å…¬ä¼—å·ï¼ˆè®¢é˜…å·å…è´¹ï¼‰</li>
        <li>ç™»å½•å…¬ä¼—å·åå°è·å–æƒé™</li>
        <li>å¯æœç´¢ä»»æ„å…¬ä¼—å·çš„æ‰€æœ‰æ–‡ç« </li>
        <li>æ”¯æŒè·å–é˜…è¯»é‡ç­‰è¯¦ç»†æ•°æ®</li>
      </ol>
      <p style="margin-top: 8px; font-size: 12px;">
        ğŸ’¡ æ²¡æœ‰å…¬ä¼—å·ï¼Ÿ<a href="https://mp.weixin.qq.com/" target="_blank" style="color: #1a73e8;">ç‚¹å‡»æ³¨å†Œ</a>ï¼ˆ5åˆ†é’Ÿå…è´¹æ³¨å†Œï¼‰
      </p>
    </div>
    
    <div id="loginStatusBox" class="login-status logged-out">
      <div class="status-info">
        <span class="status-icon">ğŸ”´</span>
        <div class="status-text">
          <h4 id="loginStatusText">æœªç™»å½•</h4>
          <p id="loginStatusDetail">éœ€è¦ç™»å½•å…¬ä¼—å·åå°</p>
        </div>
      </div>
    </div>
    
    <button id="loginMPBtn" class="btn-warning">ğŸ”‘ ç™»å½•å…¬ä¼—å·åå°</button>
    <button id="logoutMPBtn" class="btn-danger" style="display: none;">ğŸšª é€€å‡ºç™»å½•</button>
    
    <div style="margin-top: 10px;">
      <button id="extractFromCurrentBtn" class="btn-success" style="font-size: 13px; padding: 10px;">
        ğŸ“ ä»å½“å‰é¡µé¢æå–Token
      </button>
    </div>
    
    <details>
      <summary>ğŸ’¡ ä½¿ç”¨å¸®åŠ©ï¼ˆç‚¹å‡»å±•å¼€ï¼‰</summary>
      <div>
        <p style="margin-bottom: 8px;"><strong>æ–¹æ³•1ï¼šè‡ªåŠ¨ç™»å½•ï¼ˆæ¨èï¼‰</strong></p>
        <ol style="margin-bottom: 12px;">
          <li>ç‚¹å‡»"ç™»å½•å…¬ä¼—å·åå°"</li>
          <li>å¾®ä¿¡æ‰«ç ç™»å½•</li>
          <li>ç­‰å¾…è‡ªåŠ¨æå–Token</li>
        </ol>
        
        <p style="margin-bottom: 8px;"><strong>æ–¹æ³•2ï¼šä»å½“å‰é¡µé¢æå–</strong></p>
        <ol style="margin-bottom: 12px;">
          <li>å…ˆåœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨ç™»å½• mp.weixin.qq.com</li>
          <li>ç™»å½•ååœç•™åœ¨åå°é¡µé¢</li>
          <li>ç‚¹å‡»"ä»å½“å‰é¡µé¢æå–Token"</li>
        </ol>
        
        <p style="margin-bottom: 8px;"><strong>æ–¹æ³•3ï¼šæ‰‹åŠ¨è¾“å…¥ï¼ˆå¤‡ç”¨ï¼‰</strong></p>
        <ol>
          <li>ç™»å½•åæŸ¥çœ‹URLä¸­çš„ token= å‚æ•°</li>
          <li>ä¾‹å¦‚ï¼štoken=450735061</li>
          <li>ç‚¹å‡»ä¸‹æ–¹"æ‰‹åŠ¨è¾“å…¥Token"æŒ‰é’®</li>
          <li>è¾“å…¥çº¯æ•°å­—Token</li>
        </ol>
      </div>
    </details>
    
    <div style="margin-top: 10px; display: flex; gap: 8px;">
      <button id="debugLoginBtn" class="btn-secondary" style="flex: 1; font-size: 12px; padding: 8px;">
        ğŸ”§ è°ƒè¯•
      </button>
      <button id="manualTokenBtn" class="btn-secondary" style="flex: 1; font-size: 12px; padding: 8px;">
        âŒ¨ï¸ æ‰‹åŠ¨è¾“å…¥
      </button>
    </div>
    
    <div id="searchSection" class="search-section" style="display: none;">
      <input 
        type="text" 
        id="mpAccountName" 
        class="url-input" 
        placeholder="è¾“å…¥å…¬ä¼—å·åç§°ï¼ˆå¦‚ï¼šäººæ°‘æ—¥æŠ¥ï¼‰"
      />
      <button id="searchMPAccountBtn" class="btn-success">ğŸ” æœç´¢å…¬ä¼—å·æ–‡ç« </button>
      
      <div id="accountInfo" style="display: none;"></div>
      
      <div id="mpArticleList" style="display: none;">
        <div class="select-controls">
          <button id="selectAllMPBtn">å…¨é€‰</button>
          <button id="selectNoneMPBtn">å–æ¶ˆ</button>
          <button id="selectInvertMPBtn">åé€‰</button>
        </div>
        <div class="article-list" id="mpArticleListContent"></div>
        <button id="downloadMPSelectedBtn">ä¸‹è½½é€‰ä¸­æ–‡ç« </button>
      </div>
    </div>
    
    <div id="loadingMP" class="loading" style="display: none;">æ­£åœ¨æœç´¢æ–‡ç« </div>
  </div>
  
  <!-- è¿›åº¦æ¡ -->
  <div id="progressSection" style="display: none;">
    <div class="progress-bar">
      <div class="progress-fill" id="progressFill"></div>
    </div>
    <div class="progress-text" id="progressText"></div>
  </div>
  
  <div id="status"></div>
  
  <script src="popup.js"></script>
</body>
</html>